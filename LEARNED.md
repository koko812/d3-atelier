# 🧠 D3.js グリッド学習ログ（2025年5月）

---

## ✨ 初期の問い：JavaScriptでジェネラティブアートを作るための技術は？

グリッドアートをジャバスクリプトで作るときに使える、以下のような技術を紹介。

| 技術             | リリース年    | コミュニティ活動 | 特徴                          |
| -------------- | -------- | -------- | --------------------------- |
| **p5.js**      | 2014     | ★★★★☆    | 教育、アート向け。Processing直系       |
| **Three.js**   | 2010     | ★★★★★    | WebGL抽象化、3Dのですとでも最高         |
| **Canvas API** | 2005     | ★★★☆☆    | HTML5標準。ミニマル表現に向く           |
| **D3.js**      | 2011     | ★★★★☆    | データ駆動型。SVG表現に有利             |
| **GSAP**       | 2008     | ★★★★☆    | アニメ、ユーザーインタラクションに強い         |
| **Anime.js**   | 2016     | ★★★☆☆    | 軽量、シンプル。SVGもサポート            |
| **SVG**        | 1999年標準化 | ★★★★☆    | CSS/JSで操作可能なベクターグラフィック      |
| **Hydra.js**   | 2019     | ★★★☆☆    | VJ/ライブコーディングに特化             |
| **Tone.js**    | 2014     | ★★★☆☆    | WebAudioAPI拡張。音与動きを連動させたい人に |

---

## 🔍 D3.js と p5.js の比較

| 観点         | D3.js                         | p5.js                       |
| ---------- | ----------------------------- | --------------------------- |
| 概要         | データ駆動型の可視化・SVG生成ライブラリ         | Processing直系のビジュアルプログラミング環境 |
| 主な用途       | データ可視化、インタラクティブ図、構造的アート       | アート、アニメーション、教育、表現作品         |
| 描画先        | SVG（または HTML, Canvas）         | Canvas（2D）                  |
| データ構造との親和性 | ◎ データ配列・構造に基づく要素生成が得意         | △ 自分でループを書く必要がある            |
| 学習コスト      | やや高め（enter, update, exit の概念） | やさしい（座標を描けば即座に結果が見える）       |
| アニメーション    | トランジションやスケールなど、やや手間           | `draw()` ループで簡単に実現可能        |
| インタラクション   | D3イベントや外部ライブラリと併用             | `mousePressed()` など内蔵関数が豊富  |
| コード構造      | DOMとの結合が強い                    | スケッチベースで独立                  |

### ✅ まとめ

* D3.js は「**構造やデータに基づいた図形やアート**」に強く、p5.js は「**感覚的・時間的・動的なアート**」に向く。
* **論理・構造の快楽**が好きなら D3.js、**表現・アニメの快楽**が好きなら p5.js から始めるのがよい。
* 組み合わせて使うことも可能。


## ✅ スタート地点：D3.jsとは？

* **D3.js（Data-Driven Documents）** は、JavaScript で SVG, HTML, CSS を使った **インタラクティブな可視化**を構築するためのライブラリ。
* データを元に要素を生成する思想（.data() → .enter() → .append()）がコア。
* 一方で、自由度が高い分、初学者にはややとっつきにくい側面も。

---

## ✅ コッホ曲線の描画

### 📄 ファイル構成

* `index.html`
* `main.js`
* 外部CDNから d3.v7 を読み込み

### 🔁 機能

* 初期状態は一本の直線
* 「Next Step」ボタンをクリックするたびに `kochTransform()` によって線分が 1→4 に分割される
* 再帰的に再描画され、コッホ曲線が生成されていく

### 🚩 問題と気づき

* ページをリロードすると「止まる」現象 → 実際は描画が初期化されているだけ
* ただし、その後「スピナーが回り続ける」バグが一時発生 → キャッシュまたはファイル読み込み失敗だった可能性。自然復旧。
* コードの分離（HTML/JS）を徹底することに決定

### 🧠 補足

* `kochTransform` は1本の線を4本に分けるので、ステップごとに線分数が 4^n で指数的に増える
* DOMノード（SVG `<line>`）が多くなりすぎると、ブラウザが重くなる（約4000本以降注意）

---

## ✅ defer属性について

```html
<script defer src="main.js"></script>
```

* `defer` を付けると、HTMLの読み込み完了後に JS が実行される
* DOM取得タイミングが安定し、`querySelector()` が null を返すようなミスを防げる
* 複数スクリプトがあっても、読み込み順は HTML の記述順になる（async との違い）

---

## ✅ 四角形の描画 → グリッド生成へ

### 🎯 Step 1: 単一の四角形を描画

* `d3.select('svg')` → `.append('rect')`
* `x`, `y`, `width`, `height`, `fill`, `stroke` を付与

### 📦 コード構成（HTML/JS分離）

* `index.html`: svgタグだけ持つ
* `main.js`: rectを描画するロジック

### 🎯 Step 2: グリッド描画

```js
const row = 10;
const col = 10;
const size = 30;

for (let i = 0; i < row; i++) {
  for (let j = 0; j < col; j++) {
    svg.append("rect")
      .attr("x", 50 + size * j)
      .attr("y", 50 + size * i)
      .attr("width", size)
      .attr("height", size)
      .attr("fill", "skyblue")
      .attr("stroke", "black")
      .attr("stroke-width", 2);
  }
}
```

### 🎉 結果

* 10×10 の正方形グリッドが表示される
* オフセット 50px によって中央寄せに
* 綺麗な青＋黒の縁取りで見やすい

### 💡 発展アイデア（未実装）

* 色をランダムに変更する（`Math.random()` + `hsl`）
* マウスオーバーで色変化 / クリックで変形
* グリッドの各セルに異なる図形（円、線など）を配置
* 時間ベースで動くアニメーション
* `data()` / `enter()` を使ったD3流の書き方への変換

---

## 🔚 感想まとめ

* D3.js はとても強力だけど、**素直なDOM操作ではなく「データ主導でDOMを作る」考え方が肝**。
* index.html と JS を分離することで保守しやすくなり、読み込みも安定する（`defer`）。
* 小さなことでも丁寧に確認・検証して進めると、見える景色が広がる！

次はランダム要素やマウスイベントでグリッドを動的に変化させるのが良さそう！

---

## ✨ まとめ：これから

* D3.jsのコアは「データによるDOM生成」であり、グリッドや観測性をもつアート作りに最適
* 今もD3.jsは使われており，特に

  * 教育 / 研究
  * ジャーナリズム・メディア表現
  * ビジュアルデバッグやアート作品
* 以下のような流れで学ぶと良い:

  1. rectの描画
  2. 2重forでグリッド
  3. 色や大きさのランダム変化
  4. データ駆動型 (data + enter)